<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="browsermode" content="application">
    <title>Instara - 应用下载</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        neutral: '#64748B',
                        wechat: '#07C160'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .loading-spin { animation: spin 1.5s linear infinite; }
            .fade-in { animation: fadeIn 0.5s ease-in-out; }
            .bounce-icon { animation: bounce 2s infinite; }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
        .card { @apply bg-white rounded-xl shadow-lg p-6 max-w-md w-full; }
        .btn { @apply px-4 py-2 rounded-lg font-medium transition-all duration-300; }
        .btn-primary { @apply bg-primary text-white hover:bg-primary/90; }
        .btn-outline { @apply border border-primary text-primary hover:bg-primary/10; }
        .wechat-tip { @apply bg-wechat/10 border-l-4 border-wechat p-3 my-4 rounded-r text-sm; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen flex items-center justify-center p-4 font-sans">
    <div id="loading-container" class="text-center fade-in card">
        <!-- 应用图标 -->
        <div class="w-24 h-24 mx-auto mb-6 bg-primary/10 rounded-full flex items-center justify-center">
            <i class="fa fa-rocket text-4xl text-primary"></i>
        </div>
        <!-- 加载动画 -->
        <div class="w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full loading-spin mx-auto mb-6"></div>
        <!-- 状态文本 -->
        <h2 id="status-text" class="text-xl font-medium text-slate-800 mb-2">正在检测您的设备...</h2>
        <p id="message-text" class="text-neutral mb-4">请稍候，我们将为您跳转到合适的下载页面</p>
		<!-- 微信浏览器提示（iOS 默认隐藏） -->
		<div id="wechat-tip-ios" class="wechat-tip hidden">
			<p class="flex items-start">
				<i class="fa fa-info-circle text-wechat mt-0.5 mr-2"></i>
				<span>微信浏览器可能限制跳转，请点击右上角 <i class="fa fa-ellipsis-h ml-1"></i>，选择“用默认浏览器打开”以继续</span>
			</p>
		</div>

		<!-- 微信浏览器提示（Android 默认隐藏） -->
		<div id="wechat-tip-android" class="wechat-tip hidden">
			<p class="flex items-start">
				<i class="fa fa-info-circle text-wechat mt-0.5 mr-2"></i>
				<span>微信浏览器可能限制跳转，请点击右上角 <i class="fa fa-ellipsis-h ml-1"></i>，选择“在浏览器中打开”以继续</span>
			</p>
		</div>
        <!-- 手动跳转按钮（默认隐藏） -->
        <div id="manual-jump" class="hidden mt-6">
            <button id="jump-btn" class="btn btn-primary w-full mb-3">
                <i class="fa fa-download mr-2"></i>手动跳转
            </button>
            <button id="help-btn" class="btn btn-outline w-full">
                <i class="fa fa-question-circle mr-2"></i>遇到问题？
            </button>
        </div>
        <!-- 帮助信息（默认隐藏） -->
        <div id="help-info" class="hidden mt-4 text-left text-sm bg-slate-50 p-4 rounded-lg">
            <h3 class="font-medium text-slate-700 mb-2">如何手动打开 TestFlight？</h3>
            <ol class="list-decimal list-inside space-y-1">
                <li>确保已安装 TestFlight 应用</li>
                <li>如果在微信中，请先点击右上角在浏览器中打开</li>
                <li>点击上方“手动跳转”按钮</li>
                <li>当系统询问时，选择“打开”</li>
                <li>在 TestFlight 中接受邀请</li>
            </ol>
        </div>
    </div>

	<script>
		window.onload = function () {
			const userAgent = navigator.userAgent;
			const statusText = document.getElementById('status-text');
			const messageText = document.getElementById('message-text');
			const loadingContainer = document.getElementById('loading-container');
			const manualJump = document.getElementById('manual-jump');
			const helpTip = document.getElementById('help-tip');
			const jumpBtn = document.getElementById('jump-btn');
			const helpBtn = document.getElementById('help-btn');
			const helpInfo = document.getElementById('help-info');
			// 获取两个不同的微信提示元素
			const wechatTipIos = document.getElementById('wechat-tip-ios');
			const wechatTipAndroid = document.getElementById('wechat-tip-android');
			const isWechat = /MicroMessenger/i.test(userAgent);
			// 新增系统类型判断
			const isiOS = /iPhone|iPad|iPod/i.test(userAgent);
			const isAndroid = /Android|Linux/i.test(userAgent);

			setTimeout(() => {
				if (isiOS) {
					if (isWechat) {
						statusText.textContent = "请在浏览器中打开以继续";
						messageText.textContent = "微信浏览器限制了应用跳转功能";
						document.querySelector('.loading-spin').classList.add('hidden');
						// 显示iOS专用提示
						wechatTipIos.classList.remove('hidden');
						manualJump.classList.remove('hidden');
						const iconContainer = document.querySelector('.w-24');
						iconContainer.innerHTML = '<i class="fa fa-weixin text-4xl text-wechat bounce-icon"></i>';
						iconContainer.classList.remove('bg-primary/10');
						iconContainer.classList.add('bg-wechat/10');
					} else {
						// iOS非微信处理逻辑（保持不变）
						statusText.textContent = "正在为您打开 TestFlight...";
						messageText.textContent = "请稍等，正在尝试启动应用";
						const appUrl = "itms-beta://testflight.apple.com/join/QTrhXDAd";
						const webUrl = "https://testflight.apple.com/join/QTrhXDAd";
						window.location.href = appUrl;
						setTimeout(() => {
							statusText.textContent = "无法自动打开 TestFlight";
							messageText.textContent = "请手动点击下方按钮跳转";
							document.querySelector('.loading-spin').classList.add('hidden');
							manualJump.classList.remove('hidden');
							const iconContainer = document.querySelector('.w-24');
							iconContainer.innerHTML = '<i class="fa fa-exclamation-triangle text-4xl text-amber-500"></i>';
							iconContainer.classList.remove('bg-primary/10');
							iconContainer.classList.add('bg-amber-100');
							jumpBtn.addEventListener('click', () => {
								window.location.href = appUrl;
								setTimeout(() => {
									window.location.href = webUrl;
								}, 1000);
							});
						}, 3000);
					}
					helpBtn.addEventListener('click', () => {
						helpInfo.classList.toggle('hidden');
					});
				} else {
					if (isWechat) {
						// 微信环境下的Android设备：只显示引导，不自动跳转
						statusText.textContent = "请在外部浏览器中打开以下载";
						messageText.textContent = "微信浏览器限制APK文件下载";
						document.querySelector('.loading-spin').classList.add('hidden');
						wechatTipAndroid.classList.remove('hidden');
						// 更换图标为微信提示样式
						const iconContainer = document.querySelector('.w-24');
						iconContainer.innerHTML = '<i class="fa fa-weixin text-4xl text-wechat bounce-icon"></i>';
						iconContainer.classList.remove('bg-primary/10');
						iconContainer.classList.add('bg-wechat/10');
						
					} else {
						// 非微信环境的Android设备：正常自动跳转
						statusText.textContent = "正在为您跳转至 Android 下载页面...";
						messageText.textContent = "如果没有自动跳转，请点击下方按钮";
						manualJump.classList.remove('hidden');
						// 自动跳转逻辑
						setTimeout(() => {
							window.location.href = "https://download.teljane.com/en/instara.apk";
							// 备用链接
							setTimeout(() => {
								window.location.href = "https://www.pgyer.com/muC6z7dZ";
							}, 1500);
						}, 1500);

						// 手动跳转按钮
						jumpBtn.addEventListener('click', () => {
							window.location.href = "https://www.pgyer.com/muC6z7dZ";
						});
					}
					// 手动跳转按钮点击时强化提示
					helpBtn.addEventListener('click', () => {
						alert('请先点击右上角"..."选择"在浏览器中打开"，再点击下载按钮');
					});
				}
			}, 1000);
		};
	</script>
</body>
</html>
